:80 {
  root * /srv/frontend
  file_server

 # --- HOTFIX: zuerst /api/api/* abfangen und auf /api/* umschreiben ---
  @dup path_regexp dup ^/api/api/(.*)$
  handle @dup {
    uri replace ^/api/api/ /api/
    reverse_proxy backend:8080
  }

  # Prefix NICHT strippen:
  handle /api/* {
    reverse_proxy backend:8080
  }
  
  handle /* {
  try_files {path} /index.html
  file_server
}

  @assets {
    path *.js *.css *.png *.jpg *.jpeg *.gif *.svg *.ico *.webp *.woff *.woff2
  }
  header @assets Cache-Control "public, max-age=600, immutable"
}
